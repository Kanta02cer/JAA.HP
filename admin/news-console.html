<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ‹ãƒ¥ãƒ¼ã‚¹ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</title>
  <link rel="icon" href="https://i.ibb.co/6R5nX1YH/Rogo.jpg" />
      <script src="https://cdn.tailwindcss.com"></script>
    <script src="../js/unified-article-manager.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="module">
    // React
    import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18';
    import { createRoot } from 'https://esm.sh/react-dom@18/client';

    // Firebase (v9 ESM)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";
    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut,
      onAuthStateChanged, updateProfile, sendEmailVerification
    } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    import {
      getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc,
      serverTimestamp, query, orderBy
    } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyDUm0XzV9wPIHJSTsKiJ9LXqjlIA81l1Rc",
      authDomain: "jaa-hp.firebaseapp.com",
      projectId: "jaa-hp",
      storageBucket: "jaa-hp.appspot.com",
      messagingSenderId: "549447513177",
      appId: "1:549447513177:web:2f2fc2f9bfe0ddd29d6d48",
      measurementId: "G-JLRH848YQS"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const SECRET_INVITE_CODE = "JAA-NEWS-ADMIN";

    // çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã®åŒæœŸ
    async function syncToUnifiedArticleManager(articleId, data, action) {
      try {
        // è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’çµ±ä¸€
        const articleData = {
          id: articleId,
          title: data.title || 'ç„¡é¡Œã®è¨˜äº‹',
          content: data.content || '',
          category: data.category || 'ãŠçŸ¥ã‚‰ã›',
          status: data.status || 'draft',
          createdAt: data.createdAt ? data.createdAt.toDate().toISOString() : new Date().toISOString(),
          updatedAt: data.updatedAt ? data.updatedAt.toDate().toISOString() : new Date().toISOString(),
          source: 'news-console',
          lastSynced: Date.now()
        };

        // çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
        if (typeof window.unifiedArticleManager !== 'undefined') {
          await window.unifiedArticleManager.saveArticle(articleData, 'news-console');
          console.log(`çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«åŒæœŸå®Œäº†: ${action} - ${articleId}`);
        } else {
          console.log('çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¾ã™ã€‚');
        }

        // å¸¸ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚‚ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
        await saveToLocalStorage(articleId, articleData, action);
        
        // å¼·åˆ¶çš„ãªåŒæœŸå‡¦ç†ã‚’å®Ÿè¡Œ
        await forceSyncToNewsDetail(articleId, articleData);
        
      } catch (error) {
        console.error('çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        await saveToLocalStorage(articleId, data, action);
      }
    }

    // news-detail.htmlã¸ã®å¼·åˆ¶åŒæœŸ
    async function forceSyncToNewsDetail(articleId, articleData) {
      try {
        // 1. ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«
        window.dispatchEvent(new CustomEvent('jaa-news-update', {
          detail: {
            action: 'save',
            articleId: articleId,
            article: articleData,
            timestamp: Date.now(),
            type: 'NEWS_UPDATE'
          }
        }));

        // 2. localStorageã®å¼·åˆ¶æ›´æ–°
        const storageKey = 'jaa-unified-articles';
        const existingArticles = JSON.parse(localStorage.getItem(storageKey) || '[]');
        const existingIndex = existingArticles.findIndex(a => a.id === articleId);
        
        if (existingIndex >= 0) {
          existingArticles[existingIndex] = { ...existingArticles[existingIndex], ...articleData };
        } else {
          existingArticles.unshift(articleData);
        }
        
        // è¨˜äº‹ã‚’æ—¥ä»˜é †ã§ã‚½ãƒ¼ãƒˆ
        existingArticles.sort((a, b) => {
          const dateA = new Date(a.createdAt || 0);
          const dateB = new Date(b.createdAt || 0);
          return dateB - dateA;
        });
        
        localStorage.setItem(storageKey, JSON.stringify(existingArticles));

        // 3. å¼·åˆ¶æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ã®ç™ºç«
        const triggerKey = `jaa-news-update-${Date.now()}`;
        localStorage.setItem(triggerKey, JSON.stringify({
          action: 'save',
          articleId: articleId,
          article: articleData,
          timestamp: Date.now(),
          type: 'NEWS_UPDATE'
        }));
        localStorage.removeItem(triggerKey);

        console.log(`news-detail.htmlå¼·åˆ¶åŒæœŸå®Œäº†: ${articleId}`);
      } catch (error) {
        console.error('news-detail.htmlå¼·åˆ¶åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®ä¿å­˜ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    async function saveToLocalStorage(articleId, data, action) {
      try {
        const storageKey = 'jaa-unified-articles';
        const existingArticles = JSON.parse(localStorage.getItem(storageKey) || '[]');
        
        // æ—¢å­˜è¨˜äº‹ã®æ›´æ–°ã¾ãŸã¯æ–°è¦è¿½åŠ 
        const existingIndex = existingArticles.findIndex(a => a.id === articleId);
        if (existingIndex >= 0) {
          existingArticles[existingIndex] = { ...existingArticles[existingIndex], ...data };
        } else {
          existingArticles.unshift(data);
        }
        
        // è¨˜äº‹ã‚’æ—¥ä»˜é †ã§ã‚½ãƒ¼ãƒˆ
        existingArticles.sort((a, b) => {
          const dateA = new Date(a.createdAt || 0);
          const dateB = new Date(b.createdAt || 0);
          return dateB - dateA;
        });
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        localStorage.setItem(storageKey, JSON.stringify(existingArticles));
        
        console.log(`ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜å®Œäº†: ${action} - ${articleId}`);
        
      } catch (error) {
        console.error('ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
      }
    }



    // ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
    async function notifyNewsUpdate(action, articleId, article) {
      try {
        // 1. ãƒšãƒ¼ã‚¸é–“é€šä¿¡ã§ã®é€šçŸ¥
        await broadcastToOtherPages(action, articleId, article);
        
        // 2. ä»–ã®ãƒšãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
        await invalidateNewsCache();
        
        // 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚’å¼·åˆ¶å®Ÿè¡Œ
        await forceNewsRefresh();
        
        // 4. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        console.log(`ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°é€šçŸ¥å®Œäº†: ${action} - ${articleId}`);
        
        // 5. ç®¡ç†è€…å‘ã‘ã®è©³ç´°é€šçŸ¥
        showUpdateNotification(action, article);
        
      } catch (error) {
        console.error('ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°é€šçŸ¥ã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚è¨˜äº‹ã®ä¿å­˜ã¯å®Œäº†ã—ã¦ã„ã‚‹ã®ã§ã€è­¦å‘Šã®ã¿è¡¨ç¤º
        alert(`è¨˜äº‹ã¯ä¿å­˜ã•ã‚Œã¾ã—ãŸãŒã€ä»–ã®ãƒšãƒ¼ã‚¸ã¸ã®åæ˜ ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚`);
      }
    }
    
    // ãƒšãƒ¼ã‚¸é–“é€šä¿¡ã§ã®é€šçŸ¥
    async function broadcastToOtherPages(action, articleId, article) {
      try {
        // BroadcastChannel APIã‚’ä½¿ç”¨
        if (typeof BroadcastChannel !== 'undefined') {
          const channel = new BroadcastChannel('jaa-news-update');
          channel.postMessage({
            type: 'NEWS_UPDATE',
            action: action,
            articleId: articleId,
            article: article,
            timestamp: Date.now(),
            source: window.location.href
          });
          channel.close();
        }
        
        // localStorageã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        const eventData = {
          action: action,
          articleId: articleId,
          article: article,
          timestamp: Date.now(),
          type: 'NEWS_UPDATE'
        };
        
        // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
        window.dispatchEvent(new CustomEvent('jaa-news-update', { detail: eventData }));
        
        // localStorageã®å¤‰æ›´ã‚’ãƒˆãƒªã‚¬ãƒ¼
        const triggerKey = `jaa-news-update-${Date.now()}`;
        localStorage.setItem(triggerKey, JSON.stringify(eventData));
        localStorage.removeItem(triggerKey);
        
        console.log('ãƒšãƒ¼ã‚¸é–“é€šä¿¡é€šçŸ¥å®Œäº†');
        
      } catch (error) {
        console.error('ãƒšãƒ¼ã‚¸é–“é€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
      }
    }
    
    // ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã®ä½œæˆ
    async function createSampleArticles() {
      if (!confirm('ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿã“ã‚Œã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèªãŒã§ãã¾ã™ã€‚')) {
        return;
      }
      
      const sampleArticles = [
        {
          title: 'æ—¥æœ¬å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼å”ä¼š è¨­ç«‹ã®ãŠçŸ¥ã‚‰ã›',
          content: `
            <h2>æ—¥æœ¬å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼å”ä¼š è¨­ç«‹ã®ãŠçŸ¥ã‚‰ã›</h2>
            <p>å¹³ç´ ã‚ˆã‚Šå­¦ç”Ÿæ”¯æ´æ´»å‹•ã«ã”ç†è§£ã¨ã”æ”¯æ´ã‚’è³œã‚Šã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
            
            <p>ã“ã®åº¦ã€å­¦ç”Ÿã®å¯èƒ½æ€§ã‚’æœ€å¤§é™ã«å¼•ãå‡ºã—ã€ç¤¾ä¼šã¨ã®æ¶ã‘æ©‹ã¨ãªã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã€Œæ—¥æœ¬å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼å”ä¼šã€ã‚’è¨­ç«‹ã„ãŸã—ã¾ã—ãŸã€‚</p>
            
            <h3>è¨­ç«‹ã®èƒŒæ™¯</h3>
            <p>ç¾ä»£ã®å­¦ç”Ÿã¯ã€å¤šãã®å¯èƒ½æ€§ã‚’ç§˜ã‚ãªãŒã‚‰ã‚‚ã€é©åˆ‡ãªæ©Ÿä¼šã‚„ã‚µãƒãƒ¼ãƒˆãŒä¸è¶³ã—ã¦ã„ã‚‹çŠ¶æ³ã«ã‚ã‚Šã¾ã™ã€‚ç§ãŸã¡ã¯ã€ã“ã®èª²é¡Œã‚’è§£æ±ºã—ã€å­¦ç”Ÿä¸€äººã²ã¨ã‚ŠãŒè‡ªä¿¡ã‚’æŒã£ã¦ç¤¾ä¼šã«ç¾½ã°ãŸã‘ã‚‹ç’°å¢ƒã¥ãã‚Šã‚’ç›®æŒ‡ã—ã¾ã™ã€‚</p>
            
            <h3>ä¸»ãªæ´»å‹•å†…å®¹</h3>
            <ul>
              <li>å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é‹å–¶</li>
              <li>ä¼æ¥­ã¨ã®é€£æºã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—æ©Ÿä¼šã®å‰µå‡º</li>
              <li>å­¦ç”Ÿå‘ã‘ã‚­ãƒ£ãƒªã‚¢æ”¯æ´ãƒ»å°±è·æ”¯æ´</li>
              <li>å­¦ç”Ÿå›£ä½“ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ”¯æ´</li>
            </ul>
            
            <h3>ä»Šå¾Œã®å±•æœ›</h3>
            <p>ä»Šå¾Œã¯ã€å…¨å›½ã®å­¦ç”Ÿã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã€å­¦ç”Ÿã¨ä¼æ¥­ãƒ»ç¤¾ä¼šã‚’ã¤ãªããƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã—ã¦ç™ºå±•ã•ã›ã¦ã¾ã„ã‚Šã¾ã™ã€‚</p>
            
            <p>å¼•ãç¶šãã€ã”æ”¯æ´ã¨ã”å”åŠ›ã‚’è³œã‚Šã¾ã™ã‚ˆã†ã€å¿ƒã‚ˆã‚ŠãŠé¡˜ã„ç”³ã—ä¸Šã’ã¾ã™ã€‚</p>
          `,
          category: 'ãŠçŸ¥ã‚‰ã›',
          status: 'published'
        },
        {
          title: 'ç¬¬1å›å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹',
          content: `
            <h2>ç¬¬1å›å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹</h2>
            <p>æ—¥æœ¬å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼å”ä¼šã§ã¯ã€å­¦ç”Ÿã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¨ç¤¾ä¼šè²¢çŒ®æ´»å‹•ã‚’æ”¯æ´ã™ã‚‹ã€Œå­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ã‚’é–‹å§‹ã„ãŸã—ã¾ã™ã€‚</p>
            
            <h3>ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ¦‚è¦</h3>
            <p>ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€å­¦ç”ŸãŒè‡ªã‚‰ã®èƒ½åŠ›ã‚’é«˜ã‚ã€ç¤¾ä¼šã«è²¢çŒ®ã™ã‚‹æ´»å‹•ã‚’è¡Œã†ã“ã¨ã§ã€èªå®šè¨¼ã‚’å–å¾—ã§ãã‚‹åˆ¶åº¦ã§ã™ã€‚</p>
            
            <h3>èªå®šæ¡ä»¶</h3>
            <ul>
              <li>ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ãŸæ´»å‹•å®Ÿç¸¾</li>
              <li>ç¤¾ä¼šè²¢çŒ®æ´»å‹•ã¸ã®ç©æ¥µçš„ãªå‚åŠ </li>
              <li>ç¶™ç¶šçš„ãªå­¦ç¿’ã¨æˆé•·ã¸ã®æ„æ¬²</li>
              <li>ä»–è€…ã¸ã®å½±éŸ¿åŠ›ã¨ä¿¡é ¼æ€§</li>
            </ul>
            
            <h3>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æµã‚Œ</h3>
            <ol>
              <li>ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç”³è«‹ï¼‰</li>
              <li>æ›¸é¡å¯©æŸ»</li>
              <li>é¢æ¥å¯©æŸ»</li>
              <li>èªå®šè¨¼æˆä¸å¼</li>
            </ol>
            
            <h3>å¿œå‹ŸæœŸé–“</h3>
            <p>2025å¹´2æœˆ1æ—¥ã€œ2025å¹´3æœˆ31æ—¥</p>
            
            <p>å¤šãã®å­¦ç”Ÿã®çš†æ§˜ã®ã”å¿œå‹Ÿã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚</p>
          `,
          category: 'ã‚¤ãƒ™ãƒ³ãƒˆ',
          status: 'published'
        },
        {
          title: 'ä¼æ¥­ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹å§‹',
          content: `
            <h2>ä¼æ¥­ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹å§‹</h2>
            <p>æ—¥æœ¬å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼å”ä¼šã§ã¯ã€å­¦ç”Ÿã¨ä¼æ¥­ã‚’ã¤ãªãã€Œä¼æ¥­ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ã‚’é–‹å§‹ã„ãŸã—ã¾ã™ã€‚</p>
            
            <h3>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ç›®çš„</h3>
            <p>å„ªç§€ãªå­¦ç”Ÿã¨ä¼æ¥­ã‚’ãƒãƒƒãƒãƒ³ã‚°ã—ã€åŒæ–¹ã«ã¨ã£ã¦ä¾¡å€¤ã®ã‚ã‚‹é–¢ä¿‚ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚</p>
            
            <h3>ä¼æ¥­å‘ã‘ã‚µãƒ¼ãƒ“ã‚¹</h3>
            <ul>
              <li>å„ªç§€ãªå­¦ç”Ÿã®ç´¹ä»‹ãƒ»æ¨è–¦</li>
              <li>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¼ç”»ãƒ»é‹å–¶æ”¯æ´</li>
              <li>å­¦ç”Ÿå‘ã‘ä¼æ¥­èª¬æ˜ä¼šã®é–‹å‚¬æ”¯æ´</li>
              <li>å­¦ç”Ÿã®èƒ½åŠ›é–‹ç™ºãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æä¾›</li>
            </ul>
            
            <h3>å­¦ç”Ÿå‘ã‘ã‚µãƒ¼ãƒ“ã‚¹</h3>
            <ul>
              <li>ä¼æ¥­ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—ã®ç´¹ä»‹</li>
              <li>å°±è·æ´»å‹•æ”¯æ´ãƒ»ã‚­ãƒ£ãƒªã‚¢ç›¸è«‡</li>
              <li>ä¼æ¥­è¨ªå•ãƒ»è¦‹å­¦ä¼šã®é–‹å‚¬</li>
              <li>ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚»ãƒŸãƒŠãƒ¼ã®æä¾›</li>
            </ul>
            
            <h3>å‚åŠ ä¼æ¥­</h3>
            <p>ç¾åœ¨ã€è¤‡æ•°ã®ä¼æ¥­æ§˜ã¨ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã‚’çµã‚“ã§ãŠã‚Šã€ä»Šå¾Œã‚‚æ‹¡å¤§äºˆå®šã§ã™ã€‚</p>
            
            <p>ä¼æ¥­ã®çš†æ§˜ã€å­¦ç”Ÿã®çš†æ§˜ã€ãœã²ã”å‚åŠ ãã ã•ã„ã€‚</p>
          `,
          category: 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—',
          status: 'published'
        }
      ];
      
      try {
        for (const articleData of sampleArticles) {
          const docRef = await addDoc(collection(db, 'news'), {
            ...articleData,
            createdAt: serverTimestamp(),
            updatedAt: serverTimestamp()
          });
          
          // çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã®åŒæœŸ
          await syncToUnifiedArticleManager(docRef.id, articleData, 'create');
          
          // ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°é€šçŸ¥
          await notifyNewsUpdate('create', docRef.id, { ...articleData, id: docRef.id });
        }
        
        alert('ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ä»–ã®ãƒšãƒ¼ã‚¸ã«ã‚‚å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚');
        fetchArticles();
        
      } catch (error) {
        console.error('ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç„¡åŠ¹åŒ–
    async function invalidateNewsCache() {
      try {
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
        if (typeof localStorage !== 'undefined') {
          const keys = Object.keys(localStorage);
          keys.forEach(key => {
            if (key.includes('news') || key.includes('cache')) {
              localStorage.removeItem(key);
            }
          });
        }
        console.log('ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–å®Œäº†');
      } catch (error) {
        console.log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å¼·åˆ¶æ›´æ–°
    async function forceNewsRefresh() {
      try {
        // ä»–ã®ãƒšãƒ¼ã‚¸ã«é€šçŸ¥ã‚’é€ä¿¡
        if (typeof window !== 'undefined') {
          // åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ä»–ã®ãƒšãƒ¼ã‚¸ã«é€šçŸ¥
          window.postMessage({
            type: 'FORCE_NEWS_REFRESH',
            timestamp: Date.now(),
            action: 'refresh'
          }, '*');

          // è¦ªãƒšãƒ¼ã‚¸ãŒã‚ã‚‹å ´åˆï¼ˆiframeå†…ã®å ´åˆï¼‰
          if (window.parent !== window) {
            window.parent.postMessage({
              type: 'FORCE_NEWS_REFRESH',
              timestamp: Date.now(),
              action: 'refresh'
            }, '*');
          }
        }

        // Service Workerã«é€šçŸ¥ï¼ˆåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            type: 'NEWS_UPDATED',
            action: 'refresh',
            timestamp: Date.now()
          });
        }

        // çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å¼·åˆ¶æ›´æ–°
        if (typeof window.unifiedArticleManager !== 'undefined') {
          window.unifiedArticleManager.forceRefresh();
        }

        console.log('ãƒ‹ãƒ¥ãƒ¼ã‚¹å¼·åˆ¶æ›´æ–°é€šçŸ¥å®Œäº†');
      } catch (error) {
        console.log('å¼·åˆ¶æ›´æ–°é€šçŸ¥ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // æ›´æ–°é€šçŸ¥ã®è¡¨ç¤º
    function showUpdateNotification(action, article) {
      // æ—¢å­˜ã®é€šçŸ¥ãŒã‚ã‚Œã°å‰Šé™¤
      const existingNotification = document.querySelector('.news-update-notification');
      if (existingNotification) {
        existingNotification.remove();
      }

      // æ–°ã—ã„é€šçŸ¥ã‚’ä½œæˆ
      const notification = document.createElement('div');
      notification.className = 'news-update-notification fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300';
      notification.innerHTML = `
        <div class="flex items-center space-x-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          <div>
            <p class="font-bold">è¨˜äº‹${action}å®Œäº†ï¼</p>
            <p class="text-sm opacity-90">${article.title}</p>
            <p class="text-xs opacity-75">ä»–ã®ãƒšãƒ¼ã‚¸ã«è‡ªå‹•åæ˜ ã•ã‚Œã¾ã™</p>
          </div>
        </div>
      `;

      document.body.appendChild(notification);

      // 5ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆãˆã‚‹
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    // --- æ—¥æœ¬èªå…¥åŠ›æœ€é©åŒ–ã•ã‚ŒãŸRichTextEditor ---
    const RichTextEditor = ({ value, onChange }) => {
      const editorRef = useRef(null);
      const [showPreview, setShowPreview] = useState(false);
      const [previewContent, setPreviewContent] = useState('');
      const [isComposing, setIsComposing] = useState(false);
      const [lastValue, setLastValue] = useState('');

      // æ—¥æœ¬èªå…¥åŠ›ä¸­ã®çŠ¶æ…‹ç®¡ç†
      const handleCompositionStart = () => {
        setIsComposing(true);
      };

      const handleCompositionEnd = () => {
        setIsComposing(false);
        // IMEå…¥åŠ›å®Œäº†å¾Œã«å†…å®¹ã‚’æ›´æ–°
        setTimeout(() => {
          if (editorRef.current) {
            const currentContent = editorRef.current.innerHTML;
            if (currentContent !== lastValue) {
              setLastValue(currentContent);
              onChange(currentContent);
              setPreviewContent(currentContent);
            }
          }
        }, 10);
      };

      // æ”¹è‰¯ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡¦ç†
      const handleFormat = (type) => {
        const selection = window.getSelection();
        if (!selection || selection.rangeCount === 0) return;

        const range = selection.getRangeAt(0);
        if (!range || range.collapsed) return;

        const selectedText = range.toString();
        if (!selectedText) return;

        let newContent = '';
        switch (type) {
          case 'h2':
            newContent = `<h2>${selectedText}</h2>`;
            break;
          case 'bold':
            newContent = `<strong>${selectedText}</strong>`;
            break;
          case 'underline':
            newContent = `<u>${selectedText}</u>`;
            break;
          case 'ul':
            newContent = `<ul><li>${selectedText}</li></ul>`;
            break;
          case 'ol':
            newContent = `<ol><li>${selectedText}</li></ol>`;
            break;
          default:
            return;
        }

        // é¸æŠç¯„å›²ã‚’æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ç½®æ›
        range.deleteContents();
        const div = document.createElement('div');
        div.innerHTML = newContent;
        const fragment = document.createDocumentFragment();
        while (div.firstChild) {
          fragment.appendChild(div.firstChild);
        }
        range.insertNode(fragment);
        
        // ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
        editorRef.current?.focus();
        
        // å¤‰æ›´ã‚’é€šçŸ¥
        const updatedContent = editorRef.current.innerHTML;
        setLastValue(updatedContent);
        onChange(updatedContent);
        setPreviewContent(updatedContent);
      };

      // æœ€é©åŒ–ã•ã‚ŒãŸå…¥åŠ›å‡¦ç†
      const handleInput = (e) => {
        if (isComposing) return; // IMEå…¥åŠ›ä¸­ã¯å‡¦ç†ã—ãªã„
        
        const currentContent = e.target.innerHTML;
        if (currentContent !== lastValue) {
          setLastValue(currentContent);
          onChange(currentContent);
          setPreviewContent(currentContent);
        }
      };

      // ã‚­ãƒ¼ãƒ€ã‚¦ãƒ³å‡¦ç†ï¼ˆæ—¥æœ¬èªå…¥åŠ›ã®æ”¹å–„ï¼‰
      const handleKeyDown = (e) => {
        // Enterã‚­ãƒ¼ã§æ”¹è¡Œ
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          document.execCommand('insertLineBreak', false, null);
          handleInput(e);
        }
        // æ—¥æœ¬èªå…¥åŠ›ä¸­ã®ç‰¹æ®Šã‚­ãƒ¼å‡¦ç†
        if (isComposing) {
          if (e.key === 'Escape') {
            e.preventDefault();
            // IMEå…¥åŠ›ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            editorRef.current?.blur();
            editorRef.current?.focus();
          }
        }
      };

      // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å‡¦ç†ï¼ˆæ—¥æœ¬èªå…¥åŠ›ã®å®‰å®šæ€§å‘ä¸Šï¼‰
      const handleFocus = () => {
        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’æœ«å°¾ã«ç§»å‹•
        if (editorRef.current) {
          const range = document.createRange();
          const selection = window.getSelection();
          range.selectNodeContents(editorRef.current);
          range.collapse(false);
          selection.removeAllRanges();
          selection.addRange(range);
        }
      };

      // ãƒšãƒ¼ã‚¹ãƒˆå‡¦ç†ï¼ˆæ—¥æœ¬èªå…¥åŠ›ã®æ”¹å–„ï¼‰
      const handlePaste = (e) => {
        e.preventDefault();
        const text = e.clipboardData.getData('text/plain');
        document.execCommand('insertText', false, text);
        handleInput(e);
      };

      const togglePreview = () => {
        if (!showPreview) {
          setPreviewContent(editorRef.current.innerHTML);
        }
        setShowPreview(!showPreview);
      };

      // åˆæœŸå€¤ã®è¨­å®š
      useEffect(() => {
        if (value && value !== lastValue) {
          setLastValue(value);
          setPreviewContent(value);
        }
      }, [value]);

      return (
        React.createElement('div', { className: 'border border-gray-300 rounded-md' },
          React.createElement('div', { className: 'flex items-center p-2 border-b bg-gray-50 space-x-2' },
            React.createElement('button', { 
              type: 'button', 
              onClick: () => handleFormat('h2'), 
              className: 'px-3 py-1 border border-gray-300 bg-white hover:bg-gray-100 rounded-md text-sm font-medium' 
            }, 'H2'),
            React.createElement('button', { 
              type: 'button', 
              onClick: () => handleFormat('bold'), 
              className: 'px-3 py-1 border border-gray-300 bg-white hover:bg-gray-100 rounded-md text-sm font-medium' 
            }, 'å¤ªå­—'),
            React.createElement('button', { 
              type: 'button', 
              onClick: () => handleFormat('underline'), 
              className: 'px-3 py-1 border border-gray-300 bg-white hover:bg-gray-100 rounded-md text-sm font-medium' 
            }, 'ä¸‹ç·š'),
            React.createElement('button', { 
              type: 'button', 
              onClick: () => handleFormat('ul'), 
              className: 'px-3 py-1 border border-gray-300 bg-white hover:bg-gray-100 rounded-md text-sm font-medium' 
            }, 'ãƒ»ç®‡æ¡æ›¸ã'),
            React.createElement('button', { 
              type: 'button', 
              onClick: () => handleFormat('ol'), 
              className: 'px-3 py-1 border border-gray-300 bg-white hover:bg-gray-100 rounded-md text-sm font-medium' 
            }, '1. æ•°å­—ãƒªã‚¹ãƒˆ'),
            React.createElement('button', { 
              type: 'button', 
              onClick: togglePreview, 
              className: `px-3 py-1 border border-gray-300 rounded-md text-sm font-medium ${showPreview ? 'bg-blue-500 text-white' : 'bg-white hover:bg-gray-100'}` 
            }, showPreview ? 'ç·¨é›†ã«æˆ»ã‚‹' : 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼')
          ),
          showPreview 
            ? React.createElement('div', { 
                className: 'w-full h-64 p-3 bg-gray-50 overflow-y-auto border-l-4 border-blue-500',
                dangerouslySetInnerHTML: { __html: previewContent || value || '' }
              })
            : React.createElement('div', {
                ref: editorRef,
                className: 'w-full h-64 p-3 focus:outline-none overflow-y-auto',
                contentEditable: true,
                onInput: handleInput,
                onKeyDown: handleKeyDown,
                onFocus: handleFocus,
                onPaste: handlePaste,
                onCompositionStart: handleCompositionStart,
                onCompositionEnd: handleCompositionEnd,
                dangerouslySetInnerHTML: { __html: value || '' },
                style: { 
                  fontFamily: 'Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif',
                  fontSize: '16px',
                  lineHeight: '1.6',
                  wordBreak: 'break-word',
                  whiteSpace: 'pre-wrap',
                  caretColor: '#000000'
                }
              })
        )
      );
    };

    const LoadingScreen = () => (
      React.createElement('div', { className: 'flex items-center justify-center min-h-screen bg-gray-50' },
        React.createElement('div', { className: 'flex flex-col items-center' },
          React.createElement('div', { className: 'animate-spin rounded-full h-16 w-16 border-b-4 border-orange-500' }),
          React.createElement('p', { className: 'mt-4 text-lg text-gray-600' }, 'èª­ã¿è¾¼ã¿ä¸­...')
        )
      )
    );

    // ãƒ¡ãƒ¼ãƒ«èªè¨¼ç”»é¢ï¼ˆæç¤ºã‚³ãƒ¼ãƒ‰æº–æ‹ ï¼‰
    const EmailVerificationScreen = ({ user }) => {
      const [resendDisabled, setResendDisabled] = useState(false);
      const [countdown, setCountdown] = useState(15 * 60);
      const [message, setMessage] = useState('');
      const timerRef = useRef(null);

      useEffect(() => {
        timerRef.current = setInterval(() => {
          setCountdown(prev => {
            if (prev <= 1) {
              clearInterval(timerRef.current);
              return 0;
            }
            return prev - 1;
          });
        }, 1000);
        return () => clearInterval(timerRef.current);
      }, []);

      const handleResendEmail = async () => {
        setResendDisabled(true);
        setMessage('');
        try {
          await sendEmailVerification(user);
          setMessage('ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’å†é€ä¿¡ã—ã¾ã—ãŸã€‚');
        } catch (error) {
          setMessage('ãƒ¡ãƒ¼ãƒ«ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
          console.error(error);
        }
        setTimeout(() => setResendDisabled(false), 60000);
      };

      const formatTime = (seconds) => {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
      };

      return (
        React.createElement('div', { className: 'flex items-center justify-center min-h-screen bg-gray-100' },
          React.createElement('div', { className: 'w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg text-center' },
            React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' }, 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèª'),
            React.createElement('p', { className: 'text-gray-600' },
              React.createElement('strong', { className: 'text-orange-600' }, user.email),
              ' å®›ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚'
            ),
            countdown > 0
              ? React.createElement('p', { className: 'text-lg font-bold text-gray-700' }, 'ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™: ', React.createElement('span', { className: 'text-red-500' }, formatTime(countdown)))
              : React.createElement('p', { className: 'text-red-500 font-bold' }, 'èªè¨¼ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†é€ã—ã¦ãã ã•ã„ã€‚'),
            React.createElement('button', { onClick: handleResendEmail, disabled: resendDisabled, className: 'w-full py-3 font-bold text-white bg-orange-500 rounded-md hover:bg-orange-600 transition-colors duration-300 disabled:bg-gray-400' }, resendDisabled ? '60ç§’å¾Œã«å†é€å¯èƒ½' : 'ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’å†é€ã™ã‚‹'),
            message && React.createElement('p', { className: 'text-green-600 text-sm' }, message),
             React.createElement('p', { className: 'text-sm text-gray-500' }, 'ãƒ¡ãƒ¼ãƒ«ãŒè¦‹å½“ãŸã‚‰ãªã„å ´åˆã¯ã€è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã«åˆ†é¡ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€Œè¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ã§ã¯ãªã„ã€ã¨ã—ã¦ãƒãƒ¼ã‚¯ã—ã¦ãã ã•ã„ã€‚'),
            React.createElement('p', { className: 'text-sm text-gray-500 pt-4' }, 'èªè¨¼ãŒå®Œäº†ã—ãŸã‚‰ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚'),
            React.createElement('button', { onClick: () => signOut(auth), className: 'mt-2 text-sm text-gray-500 hover:underline' }, 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ')
          )
        )
      );
    };

    const AuthScreen = () => {
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [displayName, setDisplayName] = useState('');
      const [inviteCode, setInviteCode] = useState('');
      const [showPassword, setShowPassword] = useState(false);
      const [error, setError] = useState('');

      const handleAuth = async (e) => {
        e.preventDefault();
        setError('');
        try {
          if (isLogin) {
            await signInWithEmailAndPassword(auth, email, password);
          } else {
            if (inviteCode !== SECRET_INVITE_CODE) {
              setError('æ‹›å¾…ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
              return;
            }
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            await updateProfile(userCredential.user, { displayName });
            await sendEmailVerification(userCredential.user);
          }
        } catch (err) {
          setError(getFriendlyErrorMessage(err.code));
        }
      };

      const getFriendlyErrorMessage = (code) => {
        switch (code) {
          case 'auth/invalid-email':
            return 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
          case 'auth/user-not-found':
          case 'auth/wrong-password':
          case 'auth/invalid-credential':
            return 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
          case 'auth/email-already-in-use':
            return 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚';
          case 'auth/weak-password':
            return 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
          case 'auth/user-disabled':
            return 'ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
          case 'auth/operation-not-allowed':
            return 'ã“ã®ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Firebaseã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
          default:
            console.error('Authentication Error Code:', code);
            return 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã™ã‚‹ã‹ã€æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
        }
      };

      return (
        React.createElement('div', { className: 'flex items-center justify-center min-h-screen bg-gray-100' },
          React.createElement('div', { className: 'w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg' },
            React.createElement('div', { className: 'text-center' },
              React.createElement('img', { src: 'https://i.ibb.co/XZyfhHZn/image.png', alt: 'JAA Logo', className: 'w-24 mx-auto mb-4' }),
              React.createElement('h2', { className: 'text-3xl font-bold text-gray-800' }, 'ãƒ‹ãƒ¥ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ '),
              React.createElement('p', { className: 'text-gray-500' }, isLogin ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²')
            ),
            React.createElement('form', { onSubmit: handleAuth, className: 'space-y-6' },
              !isLogin && React.createElement('input', { type: 'text', value: displayName, onChange: e => setDisplayName(e.target.value), placeholder: 'æ‹…å½“è€…å', className: 'w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500', required: true }),
              React.createElement('input', { type: 'email', value: email, onChange: e => setEmail(e.target.value), placeholder: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', className: 'w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500', required: true }),
              React.createElement('div', { className: 'relative' },
                React.createElement('input', { type: showPassword ? 'text' : 'password', value: password, onChange: e => setPassword(e.target.value), placeholder: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', className: 'w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500', required: true }),
                React.createElement('button', { type: 'button', onClick: () => setShowPassword(!showPassword), className: 'absolute inset-y-0 right-0 flex items-center px-3 text-gray-500', 'aria-label': showPassword ? 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’éš ã™' : 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¡¨ç¤º' },
                  showPassword
                    ? React.createElement('svg', { xmlns: 'http://www.w3.org/2000/svg', className: 'h-5 w-5', fill: 'none', viewBox: '0 0 24 24', stroke: 'currentColor' },
                        React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a9.97 9.97 0 01-1.563 3.029m0 0l-2.14 2.14' })
                      )
                    : React.createElement('svg', { xmlns: 'http://www.w3.org/2000/svg', className: 'h-5 w-5', fill: 'none', viewBox: '0 0 24 24', stroke: 'currentColor' },
                        React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M15 12a3 3 0 11-6 0 3 3 0 016 0z' }),
                        React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z' })
                      )
                )
              ),
              !isLogin && React.createElement('input', { type: 'text', value: inviteCode, onChange: e => setInviteCode(e.target.value), placeholder: 'æ‹›å¾…ã‚³ãƒ¼ãƒ‰', className: 'w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500', required: true }),
              error && React.createElement('p', { className: 'text-red-500 text-sm text-center' }, error),
              React.createElement('button', { type: 'submit', className: 'w-full py-3 font-bold text-white bg-orange-500 rounded-md hover:bg-orange-600 transition-colors duration-300' }, isLogin ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'ç™»éŒ²ã™ã‚‹')
            ),
            React.createElement('p', { className: 'text-sm text-center text-gray-600' },
              isLogin ? 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„ã§ã™ã‹ï¼Ÿ' : 'ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã™ã‹ï¼Ÿ',
              React.createElement('button', { onClick: () => { setIsLogin(!isLogin); setError(''); }, className: 'ml-1 font-bold text-orange-500 hover:underline' }, isLogin ? 'ç™»éŒ²ã™ã‚‹' : 'ãƒ­ã‚°ã‚¤ãƒ³')
            )
          )
        )
      );
    };

    const ArticleEditor = ({ article, onDone }) => {
      const [title, setTitle] = useState(article?.title || '');
      const [content, setContent] = useState(article?.content || '');
      const [category, setCategory] = useState(article?.category || 'ãŠçŸ¥ã‚‰ã›');
      const [status, setStatus] = useState(article?.status || 'draft');
      const [isSubmitting, setIsSubmitting] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setIsSubmitting(true);
        try {
          const data = {
            title, content, category, status,
            [article?.id ? 'updatedAt' : 'createdAt']: serverTimestamp()
          };
          
          let articleId;
          if (article?.id) {
            await updateDoc(doc(db, 'news', article.id), data);
            articleId = article.id;
          } else {
            const docRef = await addDoc(collection(db, 'news'), data);
            articleId = docRef.id;
          }
          
          // ä¿å­˜æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          const action = article?.id ? 'æ›´æ–°' : 'ä½œæˆ';
          alert(`è¨˜äº‹ã‚’${action}ã—ã¾ã—ãŸï¼`);
          
          // çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã®åŒæœŸï¼ˆå…¬é–‹ãƒ»ä¸‹æ›¸ãå•ã‚ãšï¼‰
          await syncToUnifiedArticleManager(articleId, data, action);
          
          // ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°é€šçŸ¥
          await notifyNewsUpdate(action, articleId, { ...data, id: articleId });
          
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          const successMessage = status === 'published' 
            ? `è¨˜äº‹ã‚’${action}ã—ã¾ã—ãŸï¼ä»–ã®ãƒšãƒ¼ã‚¸ã«ã‚‚å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ã€‚`
            : `è¨˜äº‹ã‚’${action}ã—ã¾ã—ãŸï¼ï¼ˆä¸‹æ›¸ãã¨ã—ã¦ä¿å­˜ï¼‰`;
          alert(successMessage);
          
          onDone();
        } catch (e) {
          console.error(e);
          alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        } finally {
          setIsSubmitting(false);
        }
      };

      return (
        React.createElement('div', { className: 'bg-white p-8 rounded-xl shadow-lg' },
          React.createElement('h2', { className: 'text-2xl font-bold text-gray-800 mb-6' }, article?.id ? 'è¨˜äº‹ã‚’ç·¨é›†' : 'æ–°ã—ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ä½œæˆ'),
          React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-6' },
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-bold text-gray-700 mb-2' }, 'ã‚¿ã‚¤ãƒˆãƒ«'),
              React.createElement('input', { type: 'text', value: title, onChange: e => setTitle(e.target.value), className: 'w-full p-3 border border-gray-300 rounded-md', required: true })
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-bold text-gray-700 mb-2' }, 'ã‚«ãƒ†ã‚´ãƒª'),
              React.createElement('select', { value: category, onChange: e => setCategory(e.target.value), className: 'w-full p-3 border border-gray-300 rounded-md bg-white' },
                React.createElement('option', { value: 'ãŠçŸ¥ã‚‰ã›' }, 'ãŠçŸ¥ã‚‰ã›'),
                React.createElement('option', { value: 'ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹' }, 'ãƒ—ãƒ¬ã‚¹ãƒªãƒªãƒ¼ã‚¹'),
                React.createElement('option', { value: 'ã‚¤ãƒ™ãƒ³ãƒˆ' }, 'ã‚¤ãƒ™ãƒ³ãƒˆ'),
                React.createElement('option', { value: 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—' }, 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—'),
                React.createElement('option', { value: 'æŠ€è¡“æƒ…å ±' }, 'æŠ€è¡“æƒ…å ±'),
                React.createElement('option', { value: 'ãã®ä»–' }, 'ãã®ä»–')
              )
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-bold text-gray-700 mb-2' }, 'å†…å®¹'),
              React.createElement(RichTextEditor, { value: content, onChange: setContent })
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-bold text-gray-700 mb-2' }, 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹'),
              React.createElement('div', { className: 'flex items-center space-x-4' },
                React.createElement('label', { className: 'flex items-center' },
                  React.createElement('input', { type: 'radio', name: 'status', value: 'draft', checked: status === 'draft', onChange: e => setStatus(e.target.value), className: 'h-4 w-4 text-orange-600 border-gray-300' }),
                  React.createElement('span', { className: 'ml-2 text-gray-700' }, 'ä¸‹æ›¸ã')
                ),
                React.createElement('label', { className: 'flex items-center' },
                  React.createElement('input', { type: 'radio', name: 'status', value: 'published', checked: status === 'published', onChange: e => setStatus(e.target.value), className: 'h-4 w-4 text-orange-600 border-gray-300' }),
                  React.createElement('span', { className: 'ml-2 text-gray-800' }, 'å…¬é–‹')
                )
              )
            ),
            React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-lg p-4' },
              React.createElement('div', { className: 'flex items-start' },
                React.createElement('svg', { className: 'w-5 h-5 text-blue-500 mt-0.5 mr-2', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                  React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' })
                ),
                React.createElement('div', { className: 'text-sm text-blue-700' },
                  React.createElement('p', { className: 'font-medium' }, 'å…¬é–‹è¨­å®šã«ã¤ã„ã¦'),
                  React.createElement('p', { className: 'mt-1' }, 
                    'ã€Œå…¬é–‹ã€ã«è¨­å®šã™ã‚‹ã¨ã€è¨˜äº‹ãŒå³åº§ã«index.htmlã€news.htmlã€news-detail.htmlã«åæ˜ ã•ã‚Œã¾ã™ã€‚',
                    React.createElement('br'),
                    'ã€Œä¸‹æ›¸ãã€ã®å ´åˆã¯ã€ç®¡ç†è€…ã®ã¿ãŒé–²è¦§ã§ãã¾ã™ã€‚'
                  )
                )
              )
            ),
            React.createElement('div', { className: 'flex justify-end space-x-4 pt-4' },
              React.createElement('button', { type: 'button', onClick: onDone, className: 'px-6 py-2 font-bold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300' }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'),
              React.createElement('button', { type: 'submit', disabled: isSubmitting, className: 'px-6 py-2 font-bold text-white bg-orange-500 rounded-lg hover:bg-orange-600 disabled:bg-gray-400' }, isSubmitting ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜ã™ã‚‹')
            )
          )
        )
      );
    };

    const Dashboard = ({ user }) => {
      const [articles, setArticles] = useState([]);
      const [editingArticle, setEditingArticle] = useState(null);
      
      const fetchArticles = async () => {
        const qy = query(collection(db, 'news'), orderBy('createdAt', 'desc'));
        const qs = await getDocs(qy);
        setArticles(qs.docs.map(d => ({ id: d.id, ...d.data() })));
      };
      
      useEffect(() => { fetchArticles(); }, []);
      
      const handleDelete = async (id) => {
        if (!confirm('ã“ã®è¨˜äº‹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        try {
          await deleteDoc(doc(db, 'news', id));
          
          // çµ±åˆè¨˜äº‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¨ã®åŒæœŸ
          if (typeof window.unifiedArticleManager !== 'undefined') {
            await window.unifiedArticleManager.deleteArticle(id);
          }
          
          // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚‚å‰Šé™¤
          const storageKey = 'jaa-unified-articles';
          const existingArticles = JSON.parse(localStorage.getItem(storageKey) || '[]');
          const filteredArticles = existingArticles.filter(a => a.id !== id);
          localStorage.setItem(storageKey, JSON.stringify(filteredArticles));
          
          // ãƒ‹ãƒ¥ãƒ¼ã‚¹æ›´æ–°é€šçŸ¥
          await notifyNewsUpdate('delete', id, { id });
          
          fetchArticles();
        } catch (error) {
          console.error('è¨˜äº‹å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
          alert('è¨˜äº‹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
      };
      return (
        React.createElement('div', null,
          React.createElement('header', { className: 'bg-white shadow-md' },
            React.createElement('div', { className: 'container mx-auto px-6 py-4 flex justify-between items-center' },
              React.createElement('h1', { className: 'text-xl font-bold text-gray-800' }, 'JAAãƒ‹ãƒ¥ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ '),
              React.createElement('div', null,
                React.createElement('span', { className: 'text-gray-600 mr-4' }, `ã‚ˆã†ã“ã, ${user.displayName || user.email} ã•ã‚“`),
                React.createElement('button', { onClick: () => signOut(auth), className: 'font-bold text-orange-500 hover:underline' }, 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ')
              )
            )
          ),
          React.createElement('main', { className: 'container mx-auto p-6' },
            editingArticle
              ? React.createElement(ArticleEditor, { article: editingArticle, onDone: () => { setEditingArticle(null); fetchArticles(); } })
              : React.createElement('div', null,
                  React.createElement('div', { className: 'flex space-x-4 mb-6' },
                    React.createElement('button', { onClick: () => setEditingArticle({ title: '', content: '', category: 'ãŠçŸ¥ã‚‰ã›', status: 'draft' }), className: 'px-6 py-3 font-bold text-white bg-orange-500 rounded-lg hover:bg-orange-600 shadow-lg' }, 'ï¼‹ æ–°ã—ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æŠ•ç¨¿'),
                    React.createElement('button', { onClick: createSampleArticles, className: 'px-6 py-3 font-bold text-white bg-blue-500 rounded-lg hover:bg-blue-600 shadow-lg' }, 'ğŸ“ ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã‚’ä½œæˆ')
                  ),
                  React.createElement('div', { className: 'bg-white rounded-xl shadow-lg overflow-hidden' },
                    React.createElement('ul', { className: 'divide-y divide-gray-200' },
                      articles.length > 0 ? articles.map(a => (
                        React.createElement('li', { key: a.id, className: 'p-4 flex justify-between items-center hover:bg-gray-50' },
                          React.createElement('div', null,
                            React.createElement('h3', { className: 'font-bold text-lg text-gray-800' }, a.title),
                            React.createElement('div', { className: 'text-sm text-gray-500 mt-1 flex items-center space-x-4' },
                              React.createElement('span', null, a.createdAt?.toDate?.().toLocaleDateString('ja-JP') || ''),
                              React.createElement('span', { className: `px-2 py-0.5 text-xs font-semibold rounded-full ${a.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}` }, a.status === 'published' ? 'å…¬é–‹ä¸­' : 'ä¸‹æ›¸ã'),
                              React.createElement('span', { className: 'bg-blue-100 text-blue-800 px-2 py-0.5 text-xs font-semibold rounded-full' }, a.category || 'ã‚«ãƒ†ã‚´ãƒªãªã—')
                            )
                          ),
                          React.createElement('div', { className: 'flex space-x-2' },
                            React.createElement('button', { onClick: () => setEditingArticle(a), className: 'px-3 py-1 text-sm font-bold text-white bg-blue-500 rounded-md hover:bg-blue-600' }, 'ç·¨é›†'),
                            React.createElement('button', { onClick: () => handleDelete(a.id), className: 'px-3 py-1 text-sm font-bold text-white bg-red-500 rounded-md hover:bg-red-600' }, 'å‰Šé™¤')
                          )
                        )
                      )) : React.createElement('p', { className: 'p-4 text-gray-500' }, 'æŠ•ç¨¿ã•ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚')
                    )
                  )
                )
          )
        )
      );
    };

    const App = () => {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      useEffect(() => {
        const unsub = onAuthStateChanged(auth, async (u) => {
          if (u) {
            await u.reload();
            setUser(auth.currentUser);
          } else {
            setUser(null);
          }
          setLoading(false);
        });
        return () => unsub();
      }, []);
      if (loading) return React.createElement(LoadingScreen);
      if (user && !user.emailVerified) return React.createElement(EmailVerificationScreen, { user });
      return React.createElement('div', { className: 'bg-gray-50 min-h-screen font-sans' }, user ? React.createElement(Dashboard, { user }) : React.createElement(AuthScreen));
    };

    const root = createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>