<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>èªè¨¼URLãƒ†ã‚¹ãƒˆ - æ—¥æœ¬å­¦ç”Ÿã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼å”ä¼š</title>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f9fafb;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .test-header {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        .test-title {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        .test-content {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0.5rem;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .test-button.danger {
            background: #dc2626;
        }
        .test-button.danger:hover {
            background: #b91c1c;
        }
        .test-button.success {
            background: #16a34a;
        }
        .test-button.success:hover {
            background: #15803d;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>èªè¨¼URLãƒ†ã‚¹ãƒˆ</h1>
            <p>GitHubèªè¨¼ã®URLé‡è¤‡å•é¡Œã‚’è¨ºæ–­ã—ã¾ã™</p>
        </div>

        <div class="test-section">
            <div class="test-title">1. ç¾åœ¨ã®URLæƒ…å ±</div>
            <div class="test-content" id="current-url">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>

        <div class="test-section">
            <div class="test-title">2. CMSè¨­å®šç¢ºèª</div>
            <div class="test-content" id="cms-config">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>

        <div class="test-section">
            <div class="test-title">3. èªè¨¼URLãƒ†ã‚¹ãƒˆ</div>
            <div class="test-content" id="auth-urls">èª­ã¿è¾¼ã¿ä¸­...</div>
            <button class="test-button" onclick="testAuthURLs()">èªè¨¼URLã‚’ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <div class="test-section">
            <div class="test-title">4. ä¿®æ­£ã•ã‚ŒãŸCMSè¨­å®š</div>
            <div class="test-content" id="fixed-config">èª­ã¿è¾¼ã¿ä¸­...</div>
            <button class="test-button success" onclick="applyFixedConfig()">ä¿®æ­£ã•ã‚ŒãŸè¨­å®šã‚’é©ç”¨</button>
        </div>

        <div class="test-section">
            <div class="test-title">5. ãƒ†ã‚¹ãƒˆçµæœ</div>
            <div class="test-content" id="test-results">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>

    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <script>
        // ç¾åœ¨ã®URLæƒ…å ±ã‚’å–å¾—
        function getCurrentURLInfo() {
            const info = {
                currentURL: window.location.href,
                baseURL: window.location.origin,
                pathname: window.location.pathname,
                search: window.location.search,
                hash: window.location.hash,
                timestamp: new Date().toISOString()
            };
            return JSON.stringify(info, null, 2);
        }

        // CMSè¨­å®šã‚’ç¢ºèª
        function checkCMSConfig() {
            const config = {
                cmsLoaded: typeof CMS !== 'undefined',
                cmsVersion: typeof CMS !== 'undefined' ? CMS.version : 'N/A',
                windowCMS: typeof window.CMS !== 'undefined',
                documentReady: document.readyState
            };
            return JSON.stringify(config, null, 2);
        }

        // èªè¨¼URLã‚’ãƒ†ã‚¹ãƒˆ
        function testAuthURLs() {
            const results = [];
            
            // å•é¡Œã®ã‚ã‚‹URL
            const problematicURL = 'https://api.netlify.com/https://api.netlify.com/auth?provider=github&site_id=kanta02cer.github.io&scope=repo';
            results.push('âŒ å•é¡Œã®ã‚ã‚‹URL:');
            results.push(problematicURL);
            results.push('');
            
            // æ­£ã—ã„URL
            const correctURL = 'https://api.netlify.com/auth?provider=github&site_id=kanta02cer.github.io&scope=repo';
            results.push('âœ… æ­£ã—ã„URL:');
            results.push(correctURL);
            results.push('');
            
            // GitHub Pagesç”¨ã®URL
            const githubPagesURL = 'https://github.com/login/oauth/authorize?client_id=YOUR_CLIENT_ID&redirect_uri=https://kanta02cer.github.io/JAA.HP/admin/&scope=repo';
            results.push('ğŸ”§ GitHub Pagesç”¨URL:');
            results.push(githubPagesURL);
            
            document.getElementById('auth-urls').textContent = results.join('\n');
        }

        // ä¿®æ­£ã•ã‚ŒãŸCMSè¨­å®š
        function getFixedConfig() {
            const config = {
                backend: {
                    name: 'github',
                    repo: 'Kanta02cer/JAA.HP',
                    branch: 'main'
                },
                local_backend: false,
                media_folder: 'images/uploads',
                public_folder: '/images/uploads',
                collections: [
                    {
                        name: 'news',
                        label: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹',
                        folder: '_news',
                        create: true,
                        slug: '{{year}}-{{month}}-{{day}}-{{slug}}',
                        fields: [
                            { label: 'ã‚¿ã‚¤ãƒˆãƒ«', name: 'title', widget: 'string' },
                            { label: 'å†…å®¹', name: 'body', widget: 'markdown' }
                        ]
                    }
                ]
            };
            return JSON.stringify(config, null, 2);
        }

        // ä¿®æ­£ã•ã‚ŒãŸè¨­å®šã‚’é©ç”¨
        function applyFixedConfig() {
            try {
                if (typeof CMS !== 'undefined') {
                    CMS.init({
                        config: {
                            backend: {
                                name: 'github',
                                repo: 'Kanta02cer/JAA.HP',
                                branch: 'main'
                            },
                            local_backend: false,
                            media_folder: 'images/uploads',
                            public_folder: '/images/uploads',
                            collections: [
                                {
                                    name: 'news',
                                    label: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹',
                                    folder: '_news',
                                    create: true,
                                    slug: '{{year}}-{{month}}-{{day}}-{{slug}}',
                                    fields: [
                                        { label: 'ã‚¿ã‚¤ãƒˆãƒ«', name: 'title', widget: 'string' },
                                        { label: 'å†…å®¹', name: 'body', widget: 'markdown' }
                                    ]
                                }
                            ]
                        }
                    });
                    
                    document.getElementById('test-results').textContent = 'âœ… ä¿®æ­£ã•ã‚ŒãŸè¨­å®šãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚\n\næ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:\n1. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿\n2. ã€ŒLogin with GitHubã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯\n3. èªè¨¼ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª';
                } else {
                    document.getElementById('test-results').textContent = 'âŒ CMSãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚';
                }
            } catch (error) {
                document.getElementById('test-results').textContent = `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`;
            }
        }

        // åˆæœŸåŒ–
        function initializeTest() {
            document.getElementById('current-url').textContent = getCurrentURLInfo();
            document.getElementById('cms-config').textContent = checkCMSConfig();
            document.getElementById('fixed-config').textContent = getFixedConfig();
            document.getElementById('test-results').textContent = 'ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„...';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã«å®Ÿè¡Œ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTest);
        } else {
            initializeTest();
        }
    </script>
</body>
</html>
